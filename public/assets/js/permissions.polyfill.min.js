/*
 * Copyright (C) 2018-2019 Gigadrive - All rights reserved.
 * https://gigadrivegroup.com
 * https://qpo.st
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <https://gnu.org/licenses/>
 */

"use strict";function tryQuery(e,r){return navigator.permissions&&navigator.permissions.query?navigator.permissions.query(e):Promise.resolve({state:r})}function requestGeolocation(e){return new Promise(function(r,t){var n=e.enableHighAccuracy,i=e.timeout,o=e.maximumAge;navigator.geolocation.getCurrentPosition(function(t){t.coords,t.timestamp;r(tryQuery(e,"granted").then(function(e){e.state}))},function(t){t.code,t.message;r(tryQuery(e,"prompt"))},{enableHighAccuracy:n,timeout:i,maximumAge:o})})}function requestNotifications(e){return Notification.requestPermission().then(function(e){switch(e){case"default":return{state:"prompt"};case"granted":return{state:"granted"};case"denied":return{state:"denied"}}throw new TypeError(e)})}function requestPush(e){return new Promise(function(r,t){var n=e,i=n.serviceWorker,o=n.userVisibleOnly,s=n.applicationServerKey;if(!(i instanceof ServiceWorkerRegistration))throw new TypeError;r(i.pushManager.subscribe({userVisibleOnly:o,applicationServerKey:s}).then(function(e){return{state:"granted",subscription:e}},function(e){if("NotAllowedError"===e.name)return{state:"denied"};throw e}))})}function requestMidi(e){var r=e.sysex,t=e.software;return navigator.requestMIDIAccess({sysex:r,software:t}).then(function(e){return{state:"granted",access:e}},function(e){if("SecurityError"===e.name)return{state:"denied"};throw e})}function requestCamera(e){return new Promise(function(r,t){var n=e.constraints,i=e.peerIdentity;navigator.mediaDevices.getUserMedia({video:n||!0,peerIdentity:i},function(e){return r({state:"granted",stream:e})},function(e){"PermissionDeniedError"===e.name&&r({state:"denied"}),t(e)})})}function requestMicrophone(e){return new Promise(function(r,t){var n=e.constraints,i=e.peerIdentity;navigator.mediaDevices.getUserMedia({audio:n||!0,peerIdentity:i},function(e){return r({state:"granted",stream:e})},function(e){"PermissionDeniedError"===e.name&&r({state:"denied"}),t(e)})})}function requestSpeaker(e){return Promise.reject(new TypeError("speaker can't be requested (yet?)"))}function requestDeviceInfo(e){return Promise.reject(new TypeError("device-info can't be requested (yet?)"))}function requestBackgroundSync(e){try{var r=e.serviceWorker,t=e.tag;return r.sync.register(t).then(function(){return{state:"granted"}},function(e){if("NotAllowedError"===e.name)return{state:"denied"};throw e})}catch(e){return Promise.reject(e)}}function requestBluetooth(e){return navigator.bluetooth&&navigator.bluetooth.requestDevice?navigator.bluetooth.requestDevice(e).then(function(e){return{state:"prompt",devices:[e]}},function(e){if("NotFoundError"===e.name)return{state:"prompt",devices:[]};throw e}):Promise.reject(new TypeError("navigator.bluetooth not supported"))}function requestPersistentStorage(e){return navigator.storage.persist().then(function(e){return e?{state:"granted"}:{state:"denied"}})}function request(e){switch(e.name){case"geolocation":return requestGeolocation(e);case"notifications":return requestNotifications(e);case"push":return requestPush(e);case"midi":return requestMidi(e);case"camera":return requestCamera(e);case"microphone":return requestMicrophone(e);case"speaker":return requestSpeaker(e);case"device-info":return requestDeviceInfo(e);case"background-sync":return requestBackgroundSync(e);case"bluetooth":return requestBluetooth(e);case"persistent-storage":return requestPersistentStorage(e)}return Promise.reject(new TypeError("Unknown PermissionName: "+e.name))}self.navigator.permissions||(self.navigator.permissions={}),self.navigator.permissions.request||(self.navigator.permissions.request=request);